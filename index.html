<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>XVM-8S 仕様書 v2.0</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
    font-family: monospace;
    background:#0d0d0d;
    color:#e0e0e0;
    padding:40px;
    line-height:1.6;
}
h1,h2,h3{
    color:#4fc3f7;
    border-bottom:1px solid #333;
    padding-bottom:5px;
}
table{
    width:100%;
    border-collapse:collapse;
    margin:15px 0;
}
th,td{
    border:1px solid #333;
    padding:6px;
}
th{ background:#1a1a1a; }
pre{
    background:#000;
    padding:12px;
    color:#00ff88;
    overflow-x:auto;
}
.section{ margin-bottom:50px; }
</style>
</head>
<body>

<h1>XVM-8S 完全仕様書 v2.0</h1>

<div class="section">
<h2>1. 設計理念</h2>
<ul>
<li>初心者がエミュレータを簡単に実装できる</li>
<li>命令数は最小限（40以下）</li>
<li>固定サイクル制</li>
<li>テキスト + グラフィック対応</li>
<li>簡易OS構築可能</li>
</ul>
</div>

<div class="section">
<h2>2. CPU仕様</h2>
<ul>
<li>8bit CPU</li>
<li>アドレス空間: 16bit (64KB)</li>
<li>Little Endian</li>
<li>クロック: 1MHz</li>
</ul>

<h3>レジスタ</h3>
<table>
<tr><th>名称</th><th>説明</th></tr>
<tr><td>A</td><td>汎用</td></tr>
<tr><td>B</td><td>汎用</td></tr>
<tr><td>X</td><td>インデックス</td></tr>
<tr><td>PC</td><td>プログラムカウンタ</td></tr>
<tr><td>SP</td><td>スタックポインタ</td></tr>
<tr><td>F</td><td>フラグ</td></tr>
</table>

<h3>フラグ</h3>
<table>
<tr><th>Bit</th><th>名称</th></tr>
<tr><td>0</td><td>Z (Zero)</td></tr>
<tr><td>1</td><td>C (Carry)</td></tr>
<tr><td>7</td><td>IF (Interrupt Enable)</td></tr>
</table>
</div>

<div class="section">
<h2>3. メモリマップ</h2>
<table>
<tr><th>範囲</th><th>用途</th></tr>
<tr><td>0x0000-0x7FFF</td><td>RAM (32KB)</td></tr>
<tr><td>0x8000-0xBFFF</td><td>VRAM (16KB)</td></tr>
<tr><td>0xC000-0xC0FF</td><td>I/O</td></tr>
<tr><td>0xE000-0xFFFF</td><td>ROM / BIOS</td></tr>
</table>
</div>

<div class="section">
<h2>4. 表示仕様</h2>

<h3>Mode 0: テキストモード</h3>
<ul>
<li>40x30 文字</li>
<li>1文字 = 1byte (ASCII)</li>
<li>VRAM先頭に配置</li>
</ul>

<h3>Mode 1: グラフィックモード</h3>
<ul>
<li>128x128</li>
<li>1ピクセル = 1byte (8bit color)</li>
<li>アドレス計算:</li>
</ul>

<pre>
addr = 0x8000 + (y * 128 + x)
</pre>

<h3>パレット</h3>
<ul>
<li>0xC020-0xC02F</li>
<li>RGB332形式</li>
</ul>
</div>

<div class="section">
<h2>5. I/O仕様</h2>
<table>
<tr><th>アドレス</th><th>機能</th></tr>
<tr><td>0xC000</td><td>フレームカウンタ</td></tr>
<tr><td>0xC010</td><td>キーボード入力</td></tr>
<tr><td>0xC011</td><td>シリアル出力</td></tr>
<tr><td>0xC020-0xC02F</td><td>パレット</td></tr>
</table>
</div>

<div class="section">
<h2>6. 割り込み</h2>
<ul>
<li>IRQのみ</li>
<li>ベクタ: 0xFF00</li>
<li>発生時処理:</li>
</ul>

<pre>
PUSH PC
PUSH F
PC = 0xFF00
IF = 0
</pre>
</div>

<div class="section">
<h2>7. 命令セット（簡易版）</h2>

<table>
<tr><th>Opcode</th><th>命令</th><th>Bytes</th><th>Cycles</th></tr>
<tr><td>0x00</td><td>NOP</td><td>1</td><td>1</td></tr>
<tr><td>0x01</td><td>LD A,imm8</td><td>2</td><td>2</td></tr>
<tr><td>0x02</td><td>LD B,imm8</td><td>2</td><td>2</td></tr>
<tr><td>0x03</td><td>LD A,addr16</td><td>3</td><td>3</td></tr>
<tr><td>0x04</td><td>ST A,addr16</td><td>3</td><td>3</td></tr>
<tr><td>0x10</td><td>MOV A,B</td><td>1</td><td>1</td></tr>
<tr><td>0x20</td><td>ADD A,B</td><td>1</td><td>2</td></tr>
<tr><td>0x21</td><td>SUB A,B</td><td>1</td><td>2</td></tr>
<tr><td>0x22</td><td>AND A,B</td><td>1</td><td>2</td></tr>
<tr><td>0x23</td><td>OR A,B</td><td>1</td><td>2</td></tr>
<tr><td>0x24</td><td>XOR A,B</td><td>1</td><td>2</td></tr>
<tr><td>0x30</td><td>JMP addr16</td><td>3</td><td>3</td></tr>
<tr><td>0x31</td><td>JE addr16</td><td>3</td><td>3</td></tr>
<tr><td>0x32</td><td>JNE addr16</td><td>3</td><td>3</td></tr>
<tr><td>0x40</td><td>CALL addr16</td><td>3</td><td>4</td></tr>
<tr><td>0x41</td><td>RET</td><td>1</td><td>4</td></tr>
<tr><td>0x50</td><td>PUSH A</td><td>1</td><td>3</td></tr>
<tr><td>0x51</td><td>POP A</td><td>1</td><td>3</td></tr>
<tr><td>0x60</td><td>IN A,port</td><td>2</td><td>3</td></tr>
<tr><td>0x61</td><td>OUT port,A</td><td>2</td><td>3</td></tr>
<tr><td>0xFF</td><td>HLT</td><td>1</td><td>1</td></tr>
</table>

<p>※ 全命令 固定サイクル</p>

</div>

<div class="section">
<h2>8. BIOS仕様</h2>
<table>
<tr><th>アドレス</th><th>機能</th></tr>
<tr><td>0xFFF0</td><td>1文字出力 (A)</td></tr>
<tr><td>0xFFF4</td><td>キー入力取得</td></tr>
<tr><td>0xFFF8</td><td>画面クリア</td></tr>
</table>
</div>

<div class="section">
<h2>9. ROMフォーマット</h2>
<table>
<tr><th>Offset</th><th>内容</th></tr>
<tr><td>0x00</td><td>"X8S"</td></tr>
<tr><td>0x04</td><td>エントリポイント(16bit)</td></tr>
<tr><td>0x06</td><td>ROMサイズ</td></tr>
<tr><td>0x08</td><td>データ</td></tr>
</table>
</div>

<div class="section">
<h2>10. エミュレータ基準ループ</h2>
<pre>
while(running){
    opcode = read8(PC++);
    execute(opcode);
    cycles += cycleTable[opcode];

    if(cycles >= 16667){
        renderFrame();
        cycles -= 16667;
    }

    checkIRQ();
}
</pre>
</div>

<div class="section">
<h2>完成目標</h2>
<ul>
<li>CPU実装難易度: 低</li>
<li>教育用途対応</li>
<li>簡易OS構築可能</li>
<li>BASIC実装可能</li>
<li>ゲーム制作可能</li>
</ul>
</div>

</body>
</html>
